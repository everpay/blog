---
layout: post
author: Steve Klabnik
author_image: /img/authors/steve_klabnik.png
title: "Security Updates This Week"
image: /img/blogimages/2014-02-07.jpg
cover_image: /img/blogimages/2014-02-07-cover.jpg
tags:
- balanced
- security 
---

At Balanced, we take security very seriously. We're constantly on the lookout
for ways to improve the way we do things, and security is no exception. This
week, we landed three big improvements to different parts of Balanced that
relate to secure operations: a security vulnerability disclosure policy,
two-factor authentication on the Dashboard, and multiple API keys per
marketplace.

## Vulnerability disclosure

Vulnerabilities are both unfortunate and unavoidable. It's incredibly important
to set expectations around how disclosure of these vulnerabilities is handled.

To that end, we have a dedicated page, linked from our homepage, which clearly
spells out our security disclosure guidelines:
[https://www.balancedpayments.com/security](https://www.balancedpayments.com/security).

All of the work going into this policy was managed via [this GitHub
issue](https://github.com/balanced/www.balancedpayments.com/issues/100). If
you read it, you'll find that we took major cues from both Django and Rails'
policies when developing ours, with modifications where we differ.

We also are working on [including the whole text of the key on the
page](https://github.com/balanced/www.balancedpayments.com/issues/162), as
well. If you're not familliar with this distinction, the 'key id' we have
on that page is basically a hash of the key's contents. Hashes can contain
collisions. While we have [uploaded the key to public
keyservers](http://pgp.mit.edu:11371/pks/lookup?op=get&search=0xAE14B43B026A673F),
it's still good to replicate the full contents of the key. That will happen
shortly.

One more thing to note about these guidelines: the page says "Mail sent to that
address reaches a subset of the development team, limiting the exposure of the
issue." Currently, that subset consists of three people:
[Myself](https://github.com/steveklabnik),
[Noah](https://github.com/coderanger), and
[Mahmoud](https://github.com/mahmoudimus). The key was generated by Noah, and
then shared with myself and Mahmoud using our personal keys. In essence, there
are three copies of that private key. We feel this setup is simple, and fits
our current needs.

Any future updates to this setup will be communicated through this blog, we
won't just change the page without announcement.

## Two-factor authentication

Given that Balanced is an [Open Company](http://www.opencompany.org/directory/),
we often get feature requests via GitHub, just how we like 'em. A few months
ago, [a user requested two-factor
authentication](https://github.com/balanced/balanced-dashboard/issues/684) for
the Dashboard. And now, [we have
it](https://github.com/balanced/balanced-dashboard/pull/950)!

If you're not familiar with two factor authentication, the idea is that you need
two things (factors) to log in. Furthermore, the two factors are of different kinds.
If we required two different passwords, that wouldn't add a whole lot more security:
someone could just steal both! In our implementation of two-factor authentication,
we require you to know something (the password) and have something (your phone or
some other computing device). If you enable two-factor authentication, someone
could hack your Dashboard password, but they would _also_ need to steal your phone
in order to log in.

Here's how it works: if you go to the [account security
page](https://balancedpayments.com/#/security), you can click 'enable' to turn
on two factor authentication. On your phone, download any compatible application:
I prefer [Authy](https://www.authy.com/). The Balanced Dashboard will generate
a QR code, which you can then read via the Authy app. The app will then give you
a code to confirm that everything is working, and then two-factor authentication
is enabled for your account! The next time you log in, the Dashboard will prompt
you for a token. Open up the app, and it will give you the token. Type it into
the prompt on the Dashboard, and you're good to go!

If you're curious as to how this works, [RFC
6238](http://tools.ietf.org/html/rfc6238) is your guide.

## Multiple API keys per marketplace

This isn't so much a _new_ feature as one that we're just talking about now. And it
lacks some polish, but given our open-ness, we like to talk about in-progress things
too.  It's long [been possible to programatically create and delete API
keys](https://github.com/balanced/balanced-api/blob/revision1/features/rest/api_keys.feature),
but it wasn't really documented. We use this feature extensively for things
like guest accounts, as well as [creating a clean environment every time we run
acceptance
tests](https://github.com/balanced/balanced-api/blob/revision1/features/support/initial_setup.rb#L8-L17).

We recently had another situation where this feature was useful: A customer had
their head developer leave the company. While they reached out to us to rotate
their credentials, it's not strictly necessary: with the right API calls, you
can do this yourself.

We plan on enhancing this feature in the near future: right now, if you revoke
your initial API key, the dashboard will lose its access. We're planning on
making it prompt you for updated credentials, rather than simply not working.
If you want to rotate your initial API key before that ships, simply [email
support](mailto:support@balancedpayments.com) and we'll fix it up for you.
